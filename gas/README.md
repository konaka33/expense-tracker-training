# Google Apps Script セットアップガイド

## 手順

### 1. Google Spreadsheet の作成
1. Google Drive にアクセス
2. 「新規」→「Google スプレッドシート」→「空白のスプレッドシート」
3. スプレッドシート名を「支出管理アプリ - データ」などに変更

### 2. Apps Script の設定
1. スプレッドシートで「拡張機能」→「Apps Script」を選択
2. エディタが開いたら、デフォルトのコードを削除
3. [Code.gs](Code.gs) の内容をコピー&ペースト
4. 「プロジェクト名」を「支出管理アプリAPI」などに変更
5. 保存（Ctrl+S または Cmd+S）

### 3. デプロイ
1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」で「ウェブアプリ」を選択
3. 設定内容:
   - **説明**: 支出管理アプリ v1
   - **次のユーザーとして実行**: 自分（あなたのGoogleアカウント）
   - **アクセスできるユーザー**: 全員
4. 「デプロイ」ボタンをクリック
5. 初回は「アクセスを承認」が必要
   - 「承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「(プロジェクト名)に移動」をクリック
   - 「許可」をクリック

### 4. Web App URL の取得
1. デプロイが完了すると、「ウェブアプリ」のURLが表示される
2. このURLをコピー
   ```
   例: https://script.google.com/macros/s/ABC...XYZ/exec
   ```

### 5. main.js に URL を設定
1. プロジェクトの [main.js](../main.js) を開く
2. 9行目の `GAS_WEB_APP_URL` にURLを設定
   ```javascript
   const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/ABC...XYZ/exec';
   ```
3. ファイルを保存

### 6. 動作確認
1. ブラウザで index.html を開く
2. 支出を1件追加
3. 「同期」ボタンをクリック
4. Google Spreadsheet に「支出データ」シートが作成され、データが追加されているか確認

## トラブルシューティング

### エラー: 「このアプリは確認されていません」
- 「詳細」→「(プロジェクト名)に移動」をクリックして進める
- 自分自身のスクリプトなので安全です

### エラー: 「同期に失敗しました」
- ブラウザのコンソール（F12）を開いてエラーメッセージを確認
- GAS_WEB_APP_URL が正しく設定されているか確認
- デプロイ時に「全員」でアクセス可能に設定したか確認

### データが同期されない
- スプレッドシートを開いて「支出データ」シートが作成されているか確認
- Apps Script のエディタで「実行ログ」を確認
- デプロイを「新しいバージョン」で再度実行してみる

## データの確認方法

### スプレッドシートで確認
- 「支出データ」シートを開くとデータが表示される
- 列: ID | 日付 | カテゴリ | 金額 | メモ | 登録日時

### Apps Script で確認（デバッグ用）
1. Apps Script エディタを開く
2. 関数選択で「getAllExpenses」を選択
3. 「実行」ボタンをクリック
4. 「実行ログ」にデータが表示される

## 注意事項

- 無料版の Google Apps Script には実行時間制限（6分/実行）があります
- 大量データ（数千件以上）を一度に同期する場合は、バッチ処理の実装を検討してください
- URLは公開されるため、機密データは保存しないでください
