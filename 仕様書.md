# 支出管理アプリ（Expense Tracker）仕様書

## 1. 概要
日々の支出を記録・管理するWebアプリケーション。
ブラウザのlocalStorageとGoogle Spreadsheetを使用してデータを永続化します。

## 2. 目的
- 日常的な支出を簡単に記録できる
- カテゴリ別に支出を分析できる
- データをクラウド（Google Spreadsheet）に保存して、どこからでもアクセス可能にする

## 3. 画面構成

### 3.1 メイン画面
```
+----------------------------------+
|     支出管理アプリ               |
+----------------------------------+
| 【支出入力フォーム】              |
|  日付: [____]                    |
|  カテゴリ: [▼選択]              |
|  金額: [____] 円                 |
|  メモ: [____]                    |
|  [追加] [同期]                   |
+----------------------------------+
| 【カテゴリ別集計】               |
|  食費: 12,000円                  |
|  交通費: 5,000円                 |
|  娯楽費: 8,000円                 |
|  その他: 3,000円                 |
|  ────────────                    |
|  合計: 28,000円                  |
+----------------------------------+
| 【支出一覧】                     |
|  2025/10/29 食費 800円          |
|  ランチ              [削除]      |
|  ──────────────────             |
|  2025/10/28 交通費 500円        |
|  電車代              [削除]      |
+----------------------------------+
| [課題完了通知を送信]              |
+----------------------------------+
```

## 4. 機能一覧

### 4.1 必須機能

#### F1: 支出記録機能
- **入力項目**
  - 日付（date型input、デフォルト: 今日）
  - カテゴリ（selectプルダウン）
  - 金額（number型input、必須）
  - メモ（text型input、任意）
- **動作**
  - 「追加」ボタン押下で入力内容をlocalStorageに保存
  - 入力フォームをクリア
  - 支出一覧を自動更新

#### F2: 支出一覧表示機能
- **表示内容**
  - 日付、カテゴリ、金額、メモを時系列（降順）で表示
  - 各行に削除ボタンを配置
- **動作**
  - ページ読み込み時にlocalStorageから全データ取得
  - 最新の支出が上に表示される

#### F3: 削除機能
- **動作**
  - 削除ボタン押下で確認ダイアログ表示
  - OKで該当データをlocalStorageから削除
  - 支出一覧とカテゴリ別集計を自動更新

#### F4: カテゴリ別集計機能
- **表示内容**
  - 各カテゴリごとの合計金額
  - 全体の合計金額
- **動作**
  - 支出データの追加・削除時に自動再計算
  - 0円のカテゴリも表示（0円と表示）

#### F5: Google Spreadsheet連携機能
- **動作**
  - 「同期」ボタン押下でlocalStorageのデータをGoogle Spreadsheetに送信
  - Google Apps Script（GAS）のWeb APIを使用
  - 同期成功/失敗をユーザーに通知

#### F6: 課題完了通知機能
- **動作**
  - 「課題完了通知を送信」ボタン押下
  - 管理者のLINEに通知を送信（LINE Notify API使用）
  - 通知内容: アプリURL、仕様書URL、完了日時

## 5. 入出力仕様

### 5.1 データ構造（localStorage）

**キー**: `expenses`
**値**: JSON文字列（オブジェクト配列）

オブジェクト配列形式で、各支出データは以下のプロパティを持つオブジェクトとして保存されます。

```json
[
  {
    "id": 1696501234567,
    "date": "2025-10-29",
    "category": "食費",
    "amount": 800,
    "memo": "ランチ"
  },
  {
    "id": 1696501234568,
    "date": "2025-10-28",
    "category": "交通費",
    "amount": 500,
    "memo": "電車代"
  },
  {
    "id": 1696501234569,
    "date": "2025-10-27",
    "category": "家賃",
    "amount": 80000,
    "memo": "10月分家賃"
  }
]
```

**データ型定義**:
```typescript
interface Expense {
  id: number;        // タイムスタンプ（ユニークID）
  date: string;      // 日付（YYYY-MM-DD形式）
  category: string;  // カテゴリ（プルダウンから選択）
  amount: number;    // 金額（正の整数）
  memo: string;      // メモ（任意のテキスト）
}

type Expenses = Expense[];
```

### 5.2 カテゴリ一覧（固定値）
selectプルダウンで選択する形式で実装します。

- 食費
- 交通費
- 娯楽費
- 日用品
- 医療費
- 公共料金
- 家賃
- その他

### 5.3 Google Spreadsheet連携API

**エンドポイント**: Google Apps ScriptのWeb App URL
**メソッド**: POST
**リクエストボディ**:
```json
{
  "expenses": [
    {
      "id": 1696501234567,
      "date": "2025-10-29",
      "category": "食費",
      "amount": 800,
      "memo": "ランチ"
    }
  ]
}
```

**レスポンス**:
```json
{
  "status": "success",
  "message": "3件のデータを同期しました"
}
```

## 6. 使用技術

### 6.1 フロントエンド
- **HTML5**: セマンティックタグを使用
- **CSS3**: レスポンシブデザイン（モバイル対応）
- **JavaScript (ES6+)**:
  - モジュールパターン使用
  - イベントドリブン設計
  - localStorage API
  - Fetch API（GAS連携）

### 6.2 バックエンド
- **Google Apps Script (GAS)**:
  - SpreadsheetApp API
  - doPost関数でWebアプリ化

### 6.3 データ永続化
- **localStorage**: ブラウザ内保存
- **Google Spreadsheet**: クラウド保存

### 6.4 ホスティング
- **GitHub Pages**: 静的サイトホスティング

### 6.5 バージョン管理
- **Git/GitHub**: ソースコード管理

## 7. ファイル構成

```
expense-tracker/
├── index.html          # メインHTML
├── style.css           # スタイルシート
├── main.js             # メインロジック
├── spec.md             # 本仕様書
├── prompts.txt         # AI対話記録
├── README.md           # プロジェクト説明
└── gas/
    └── Code.gs         # Google Apps Script
```

## 8. 非機能要件

### 8.1 ブラウザ対応
- Chrome（最新版）
- Firefox（最新版）
- Safari（最新版）
- Edge（最新版）

### 8.2 レスポンシブ対応
- PC: 1200px以上
- タブレット: 768px〜1199px
- スマートフォン: 767px以下

### 8.3 データ制限
- localStorage: 最大5MB（約5000件の支出データ想定）

### 8.4 エラーハンドリング
- 入力バリデーション（金額が0以下の場合エラー）
- API通信エラー時のリトライなし、エラーメッセージ表示のみ
- localStorage容量超過時の警告表示

## 9. 開発スケジュール（想定）

| フェーズ | 作業内容 | 所要時間 |
|---------|---------|---------|
| Phase 1 | 仕様書作成・レビュー | 1時間 |
| Phase 2 | HTML/CSS実装 | 1.5時間 |
| Phase 3 | JavaScript実装（localStorage） | 2時間 |
| Phase 4 | GAS実装・連携 | 1.5時間 |
| Phase 5 | テスト・デバッグ | 1時間 |
| Phase 6 | GitHub Pages公開 | 0.5時間 |

## 10. テスト項目

### 10.1 機能テスト
- [ ] 支出を追加できる
- [ ] 支出一覧が表示される
- [ ] 支出を削除できる
- [ ] カテゴリ別集計が正しく計算される
- [ ] Google Spreadsheetに同期できる
- [ ] 課題完了通知を送信できる

### 10.2 バリデーションテスト
- [ ] 金額が未入力の場合エラー表示
- [ ] 金額が0以下の場合エラー表示
- [ ] カテゴリが未選択の場合エラー表示

### 10.3 動作テスト
- [ ] ページリロード後もデータが保持される
- [ ] 複数の支出を連続で追加できる
- [ ] 削除後に集計が再計算される

## 11. 備考

### 11.1 今後の拡張案
- 月別集計機能
- グラフ表示（Chart.js使用）
- 予算設定・アラート機能
- CSVエクスポート機能
- 収入記録機能

### 11.2 既知の制限事項
- localStorageはブラウザ依存のため、別ブラウザからはアクセス不可
- Google Spreadsheet連携はネット接続必須
- LINE通知はLINE Notifyトークンの取得が必要
